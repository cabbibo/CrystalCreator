<html>

  <style>
    body{
      left:0px;
      top:0px;
      margin:0px;
    }
  </style>
  <body>

<script src="three.js"></script>
<script src="jquery.min.js"></script>
<script src="CrystalGeometry.js"></script>
<script src="TrackballControls.js"></script>
<script src="ShaderLoader.js"></script>

<script>

    var scene, camera, renderer;
    var geometry, material, mesh;
    var controls;

    var crystals = [];

    var shaders = new ShaderLoader('shaders');

    shaders.load( 'vs-rainbow' , 'sem' , 'vertex'   );
    shaders.load( 'fs-rainbow' , 'sem' , 'fragment' );

    shaders.shaderSetLoaded = function(){
      init();
      animate();
    }

    function init() {

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000000 );
        camera.position.z = 1000;

        controls = new THREE.TrackballControls( camera );

        var attributes = {
          normal:{type:"v3" , value:null }

        }

        var matcap = THREE.ImageUtils.loadTexture( 'img/rough-aluminium.jpg' );
        var vs = shaders.vs.sem;
        var fs = shaders.fs.sem;


        for( var i = 0; i < 500; i++ ){


          var x = Math.random() * 1.8 *Math.PI;
          var y = Math.random() * 4. * Math.PI;
          var z = Math.random()  * 1. *Math.PI;
          
          
          var height = 100 + Math.random() * 400;

          var width = 10 + Math.random() * 20;
          var numOf = 20 + Math.floor( z * 20 );
          var e = Math.random() * 10;
          var geometry = CrystalGeometry( height , width , numOf , e  );

          var uniforms = {

            t_matcap:{type:"t" , value: matcap },
            hovered:{ type:"f" , value:0 }

          }

          material = new THREE.ShaderMaterial({
            attributes: attributes,
            uniforms:   uniforms,
            vertexShader: vs,
            fragmentShader: fs
          });

          mesh = new THREE.Mesh( geometry, material );

          mesh.rotation.x = x;
          mesh.rotation.y = y;
          mesh.rotation.z = z; 

          crystals.push( mesh );
          scene.add( mesh );

        }

         var uniforms = {

          t_matcap:{type:"t" , value: matcap },
          hovered:{ type:"f" , value:0 }

        }

        material = new THREE.ShaderMaterial({
          uniforms:   uniforms,
          vertexShader: vs,
          fragmentShader: fs,
          side: THREE.DoubleSide,
          shading: THREE.FlatShading //flat
        });

        var geo = new THREE.IcosahedronGeometry(6000,1);
        geo.computeFaceNormals();
        var bg = new THREE.Mesh( geo , material );
        scene.add( bg );

        

        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );

        document.body.appendChild( renderer.domElement );

    }

    function animate() {

        requestAnimationFrame( animate );

        controls.update();
       // mesh.rotation.x += 0.01;
       // mesh.rotation.y += 0.02;

        renderer.render( scene, camera );

    }

  </script>

</body>
</html>
