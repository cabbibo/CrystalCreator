<html>

  <style>
    body{
      left:0px;
      top:0px;
      margin:0px;
    }
  </style>
  <body>

<script src="../lib/three.js"></script>
<script src="../lib/jquery.min.js"></script>
<script src="../lib/TrackballControls.js"></script>
<script src="../lib/ShaderLoader.js"></script>

<script src="SnowflakeGeometry.js"></script>

<script>

    var scene, camera, renderer;
    var geometry, material, mesh;
    var controls;

    var crystals = [];

    var shaders = new ShaderLoader('../shaders');

    shaders.load( 'vs-snow' , 'snow' , 'vertex'   );
    shaders.load( 'fs-snow' , 'snow' , 'fragment' );

    shaders.shaderSetLoaded = function(){
      init();
      animate();
    }

    function init() {

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1000000 );
        camera.position.z = 1000;

        controls = new THREE.TrackballControls( camera );

        var matcap = THREE.ImageUtils.loadTexture( '../img/rough-aluminium.jpg' );
        var attributes = {
          normal:{type:"v3" , value:null }
        }
        
        var uniforms = {
          t_matcap:{type:"t" , value:matcap}
        }

        var vs = shaders.vs.snow;
        var fs = shaders.fs.snow;
    
        var material = new THREE.ShaderMaterial({

          attributes: attributes,
          uniforms:   uniforms,
          vertexShader: vs,
          fragmentShader: fs,
          side: THREE.DoubleSide

        });

        var geometry = new SnowflakeGeometry();

        var mesh = new THREE.Mesh( geometry, material );

        scene.add( mesh );

        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
       
        window.addEventListener( 'resize', onWindowResize , false );

        document.body.appendChild( renderer.domElement );

    }

    function animate() {

        requestAnimationFrame( animate );

        controls.update();
       // mesh.rotation.x += 0.01;
       // mesh.rotation.y += 0.02;

        renderer.render( scene, camera );

    }

      // Resets the renderer to be the proper size
  function onWindowResize(){

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();


    renderer.setSize( window.innerWidth, window.innerHeight );
   
    var dpr = devicePixelRatio || 1;

    //camUniforms.SS.value.x = window.innerWidth * dpr;
    //camUniforms.SS.value.y = window.innerHeight * dpr;


  }
  </script>

</body>
</html>
